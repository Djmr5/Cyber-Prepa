{% extends 'layout/base.html' %}
{% load static %}

{% block title %}
Index
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'vendor/bootstrap-5.2.3-dist/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'vendor/fontawesome-free-6.4.2-web/css/all.min.css' %}">
{% endblock %}

{% block content %}
<h1>Bienvenido a Ciber Tec</h1>
{% if user.is_authenticated %}
<h3 id="user-info" data-username="{{ user.username }}">Usuario: {{ user.username }}</h3>
{% endif %}
<div class="cyber__wrapper">

    <div class="cyber__cards">

        {% for game in games %}
        <div class="cyber__card [ is-collapsed ]">

            <div id="{{ game.name }}" class="cyber__card__inner [ js-expander ]">
                <span>{{ game.displayName }}</span><br>
                <img class="cyber__image" src="{% static game.file_route %}" alt="Futbolito 1">
                <div class="remaining__time">
                    <p id="cyber__countdown__{{ forloop.counter }}"> No data</p>
                </div>
            </div>

            {% if user.is_authenticated %}
            <div class="cyber__card__expander">
            <link rel="stylesheet" href="{% static 'vendor/DataTables/datatables.min.css' %}">
                <i class="fa fa-close [ js-collapser ]"></i>

                <form class="input-group mb-3" id="add-student-game-{{ game.id }}">
                    {% csrf_token %}
                    <input type="hidden" name="game_id" value="{{ game.id }}">
                    <input type="text" class="form-control" name="student_id" placeholder="ID estudiante" aria-label="ID estudiante" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="submit">Agregar estudiante</button>
                    </div>
                </form>

                <div class="collapsed__students">
                    <ul class="container__dropzone">
                        {% for player in game.plays_data %}
                        <div id="{{ player.student_id }}" data-gameName="{{ game.name }}" class="student draggable" draggable="true">
                            <li>{{ player.student_id }}</li>
                            <form class="" id="end-play-form-{{ player.student_id }}">
                                {% csrf_token %}
                                <input type="hidden" name="student_id" value="{{ player.student_id }}">
                                <button type="submit" class="btn btn-success">End Play</button>
                            </form>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalSanciones" data-bs-matricula="{{ player.student_id}}" >Sancionar</button>
                        </div>
                        {% endfor %}
                    </ul>
                    <button class="scroll-button left">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-square-fill" viewBox="0 0 16 16">
                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm10.5 10V4a.5.5 0 0 0-.832-.374l-4.5 4a.5.5 0 0 0 0 .748l4.5 4A.5.5 0 0 0 10.5 12z"/>
                        </svg>
                    </button>
                    <button class="scroll-button right">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-square-fill" viewBox="0 0 16 16">
                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.5 10a.5.5 0 0 0 .832.374l4.5-4a.5.5 0 0 0 0-.748l-4.5-4A.5.5 0 0 0 5.5 4v8z"/>
                        </svg>
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}

    </div>

    <!-- modal: Change the user play -->
    <!-- <div id="confirmation_modal" class="change_play_modal">
        <div class="modal-content">
            <span>Estás seguro que quieres cambiar al usuario X del juego Y al juego Z</span>
            <div class="buttons-container">
                <button class="confirmation-button">Confirmar</button>
                <button class="reject-button">Cancelar</button>
            </div>
        </div>
    </div> -->

    <!-- Modal for add/edit -->
    <div class="modal fade" id="changeUserPlayModal" tabindex="-1" aria-labelledby="changeUserPlayModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Estás cambiando a un usuario de juego</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="name" class="col-form-label">ID Usuario:</label>
                        <input type="text" class="form-control" id="id_usuario" name="id_usuario" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="name" class="col-form-label">Play actual:</label>
                        <input type="text" class="form-control" id="actual_play" name="actual_play" required disabled>

                        <label for="name" class="col-form-label">Play nuevo:</label>
                        <input type="text" class="form-control" id="nuevo_play" name="nuevo_play" required disabled>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-green" id="confirmPlayChange">Confirmar</button>
                    <button type="button" class="btn btn-primary btn-red" id="rejectPlayChange">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End of modal for add/edit -->

</div>

<div id="success-alert" class="alert alert-success d-none" role="alert">
    <!-- Succesfull messages will be inserted here -->
</div>

<div id="error-alert" class="alert alert-danger d-none" role="alert">
    <!-- Error messages will be inserted here -->
</div>

<!-- modal: add user to sanctions -->
<div class="modal fade" id="modalSanciones" tabindex="-1" aria-labelledby="modalSancionesLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalSancionesLabel">Nueva sanción</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="matriculaSancion" class="col-form-label">Matrícula:</label>
            <input type="text" class="form-control" id="matriculaSancion">
          </div>
          <div class="mb-3">
            <label for="causaSancion" class="col-form-label">Causa:</label>
            <textarea class="form-control" id="causaSancion"></textarea>
          </div>
          <div class="mb-3">
            <label for="diasSancion" class="col-form-label">Fin de la sancion:</label>
            <input type="date" id="diasSancion" name="diasSancion">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="sancionarBtn" data-bs-dismiss="modal">Sancionar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<!-- Added Popper through CDN -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
    crossorigin="anonymous"></script>
<script src="{% static 'vendor/bootstrap-5.2.3-dist/js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/cards.js' %}"></script>
{% if user.is_authenticated %}
<script src="{% static 'js/auth_cards.js' %}"></script>
<script src="{% static 'js/scroll_left_right.js' %}"></script>
<script src="{% static 'js/drag_drop.js' %}"></script>
<script src="{% static 'js/sanction_modal.js' %}"></script>
<script src="{% static 'js/sanctions.js' %}"></script>
{% endif %}
{% endblock %}